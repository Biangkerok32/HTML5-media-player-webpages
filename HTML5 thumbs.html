<html> 

<head>
<script src="jquery-3.4.1.min.js"></script>
</head> 

<body>

<style>
video{
	width:90%; 
	height:auto; 
	background:#000;
}

figcaption {
    color: white;
    font-size: 10px;
    display: inline-grid;
    position: absolute;
	background-color: #00000099;
}

figure {
    display: inline-grid;
    margin: 0px;
	}
</style>

<button onclick="setPlusFrames()" type="button">+ 3 thumbs</button>
<button onclick="setMinusFrames()" type="button">- 3 thumbs</button>
<button onclick="clr()" type="button">Clear</button>
<input type="text" size="105" name="txtBx" id="txtBx">

<input type="button" Value="Load Video" onClick="changeValue();">
<input type="button" Value="Generate Thumbs" onClick="doThumbs();"><br>
<span id="frames">24</span>


<div style="width:90%; text-align:center;">


<video id="video" width="100%" controls>
    <source id="VdoSrc" src=""></source>
</video>

<div id="currTime" style="position: fixed;bottom: 0.17%;right: 0.73%;color: white;background-color: black;font-size: 230%;font-weight: bold;"></div>

<div id=thumbs></div>


<script>

   function formatTime(seconds) {
    minutes = Math.floor(seconds / 60);
    minutes = (minutes >= 10) ? minutes : "0" + minutes;
    seconds = Math.floor(seconds % 60);
    seconds = (seconds >= 10) ? seconds : "0" + seconds;
    return minutes + ":" + seconds;
  }

var t=24;
var nowFlag=-1;
var captions=[];

$("#thumbs").ready(function() {
  $("#thumbs").on("click", "figure", function() {

    var index = $("figure").index(this);
	  //console.log($(('#thumbs > figure > canvas')[index]));
  nowFlag=index;
video.currentTime = $('#thumbs > figure')[index].querySelector('canvas').attributes.timestamp.nodeValue;
if (!document.pictureInPictureElement) {
		 $(window).scrollTop(0);
		 }
  });
});

	function setPlusFrames() {
	t += 3;
	  document.getElementById("frames").innerHTML = t;
	}

	function setMinusFrames() {

	t=(t<3)?0:t-3;
	document.getElementById("frames").innerHTML = t;

	}

function clr(){
document.getElementById('txtBx').value=""

}


function changeValue()
{
    var txtVal = document.getElementById('txtBx').value;
    alert(txtVal);  
    var vid = document.getElementById('VdoSrc');
    vid.src = txtVal;  
    var myVdo = document.getElementById("video");     
    myVdo.load(); 
  myVdo.pause();
if((myVdo)&&(myVdo.currentTime>=0)){
let curr  =document.getElementById("currTime");
curr.innerText= formatTime(myVdo.currentTime);
}
  }

function doThumbs()
{
captions=[];
var lock_t=t;
    var txtVal = document.getElementById('txtBx').value;
    //alert(txtVal);  
    var myVdo = document.getElementById("video");     
    myVdo.load(); 

var aseek=1;
var i = 0;
var ttmp=1;

var video = document.getElementById("video");

var thumbs = document.getElementById("thumbs");

var curr  =document.getElementById("currTime");

if((video)&&(video.currentTime>=0)){
curr.innerText= formatTime(video.currentTime);
}


 video.addEventListener('timeupdate', function() {
	curr.innerText= formatTime(video.currentTime);

	for(let i=0;i<captions.length;i++){
	captions[i].innerText=captions[i].previousSibling.attributes.timestamp_fmt.nodeValue;
	captions[i].style.backgroundColor="#00000099";
	}
	
	let cap=video.currentTime*(lock_t+1)/video.duration;
	let cap_el=Math.floor(cap);
	
if(captions.length==lock_t){
if (cap_el<captions.length){

	if(nowFlag>-1){
			captions[nowFlag].innerText=captions[nowFlag].previousSibling.attributes.timestamp_fmt.nodeValue+" (NOW!)";
			captions[nowFlag].style.backgroundColor="#0004ff99";
			nowFlag=-1;
	}else if ((cap==cap_el)&&(cap_el>0)){
			captions[cap_el-1].innerText=captions[cap_el-1].previousSibling.attributes.timestamp_fmt.nodeValue+" (NOW!)";
			captions[cap_el-1].style.backgroundColor="#0004ff99";
	}else{
			captions[cap_el].innerText=captions[cap_el].previousSibling.attributes.timestamp_fmt.nodeValue+" (NEXT)";
	if (cap_el>0){
			captions[cap_el-1].innerText=captions[cap_el-1].previousSibling.attributes.timestamp_fmt.nodeValue+" (LAST)";
			captions[cap_el-1].style.backgroundColor="#006115c7";
	}
	}
}else{

	if(nowFlag>-1){
			captions[nowFlag].innerText=captions[nowFlag].previousSibling.attributes.timestamp_fmt.nodeValue+" (NOW!)";
			captions[nowFlag].style.backgroundColor="#0004ff99";
			nowFlag=-1;
	}else if (cap==cap_el){
			captions[cap_el-1].innerText=captions[cap_el-1].previousSibling.attributes.timestamp_fmt.nodeValue+" (NOW!)";
			captions[cap_el-1].style.backgroundColor="#0004ff99";
	}else{
		captions[cap_el-1].innerText=captions[cap_el-1].previousSibling.attributes.timestamp_fmt.nodeValue+" (LAST)";
		captions[cap_el-1].style.backgroundColor="#006115c7";
		}
		
}
}
}, false);
 
 
video.addEventListener('loadeddata', function() {
	thumbs.innerHTML = "";
    video.currentTime =   (video.duration)/(lock_t+1);
}, false);

video.addEventListener('seeked', function() {

if(aseek==1){

    generateThumbnail();

    ttmp++;
i=ttmp*(video.duration/(lock_t+1));

    if (ttmp<=lock_t) {

        video.currentTime = i;

    }
	else {

aseek=0;
    return;
    }
}
else{
return;
}
}, false);



function generateThumbnail() {
var f = document.createElement("figure");
var ct=document.createElement("figcaption");
console.log(f);
  var c = document.createElement("canvas");
  var ctx = c.getContext("2d");
var scl=0.3
  c.width = video.clientWidth*scl;
  c.height = video.clientHeight*scl;
  
c.setAttribute('timestamp', video.currentTime);
let format_time=formatTime(video.currentTime);
c.setAttribute('timestamp_fmt', format_time);


  ctx.drawImage(video, 0, 0, c.width, c.height);


 thumbs.appendChild(f);

  f.appendChild(c);
    
  ct.innerHTML=format_time;
  f.appendChild(ct);
  captions.push(ct);
 
  }
}




</script>

</body> 

</html>