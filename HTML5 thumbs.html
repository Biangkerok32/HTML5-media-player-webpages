<html> 

<head>
<script src="jquery-3.4.1.min.js"></script>
</head> 

<body>

<style>
video{
	width:90%; 
	height:auto; 
	background:#000;
}

figcaption {
    color: white;
    font-size: 10px;
    display: inline-grid;
    position: absolute;
	background-color: #00000099;
}

figure {
    display: inline-grid;
    margin: 0px;
	}
</style>

<button onclick="setPlusFrames()" type="button">+ 3 thumbs</button>
<button onclick="setMinusFrames()" type="button">- 3 thumbs</button>
<button onclick="clr()" type="button">Clear</button>
<input type="text" size="105" name="txtBx" id="txtBx">

<input type="button" Value="Load Video" onClick="changeValue();">
<input type="button" Value="Generate Thumbs" onClick="doThumbs();"><br>
<span id="frames">24</span>


<div style="width:90%; text-align:center;">


<video id="video" style="width:90%;" controls>
    <source id="VdoSrc" src=""></source>
</video>

<div id="currTime" style="position: fixed;bottom: 0.17%;right: 0.73%;color: white;background-color: black;font-size: 185%;font-weight: bold;"></div>

<div id="thumbs"></div>

<script>
var t=24;
var loadFlag=false;
var nowFlag=-1;
var aseek=0;
var captions=[];
var ttmp=1;
var thumbs=document.getElementById("thumbs");
var curr  =document.getElementById("currTime");
var txtBx = document.getElementById('txtBx');
var myVdo = document.getElementById("video"); 
var vid = document.getElementById('VdoSrc');

   function formatTime(seconds,precise) {
var minutes = Math.floor(seconds / 60);
var secs = seconds % 60;
let floorSecs =Math.floor(secs);
if (typeof precise!=='undefined'){
	minutes +="m";
if(precise==1){
secs =Math.floor((seconds-floorSecs) *10);
secs=" "+floorSecs+"."+Math.max(0,secs).toLocaleString('en-GB', {minimumFractionDigits: 0, maximumFractionDigits: 0})+"s";
}else if(precise==2){
	secs =Math.floor((seconds-floorSecs) *1000);
	secs=" "+floorSecs+"s "+Math.max(0,secs).toLocaleString('en-GB', {minimumFractionDigits: 0, maximumFractionDigits: 0})+"ms";
	}
}else{
	minutes=(minutes < 10) ? "0" + minutes: minutes;
	secs = (seconds < 10) ? ":0" + floorSecs:":"+floorSecs ;
}

	return minutes + secs;
  }  

$("#thumbs").ready(function() {
  $("#thumbs").on("click", "figure", function() {
    var index = $("figure").index(this);
	nowFlag=index;
	  //console.log($(('#thumbs > figure > canvas')[index]));

video.currentTime = $('#thumbs > figure')[index].querySelector('canvas').attributes.timestamp.nodeValue;
if (!document.pictureInPictureElement) {
		 $(window).scrollTop(0);
		 }
  });
});

	function setPlusFrames() {
	if (aseek==0){
			t += 3;
			document.getElementById("frames").innerHTML =(loadFlag===true)?t+" - Thumbnails every: "+formatTime((document.getElementById("video").duration)/(t+1),2):t;
			}
	}

	function setMinusFrames() {
		if (aseek==0){
		t=(t<6)?3:t-3;
		document.getElementById("frames").innerHTML =(loadFlag===true)?t+" - Thumbnails every: "+formatTime((document.getElementById("video").duration)/(t+1),2):t;
		}
	}

function clr(){
document.getElementById('txtBx').value=""
}


function changeValue()
{
	loadFlag=false;
	ttmp=1;
	let txtVal=txtBx.value;
    alert(txtVal);  
    vid.src = txtVal;      
    myVdo.load(); 
  myVdo.pause();
  	captions=[];
	thumbs.innerHTML="";
  var interval= setInterval(checkDur, 150);

function checkDur() {
	if ((myVdo)&&(myVdo.currentTime>=0)&&(myVdo.duration>=0)){
	loadFlag=true;
	myVdo.currentTime=0;	
		curr.innerText= formatTime(myVdo.currentTime)+"\n("+myVdo.playbackRate.toLocaleString('en-GB', {minimumFractionDigits: 0, maximumFractionDigits: 7})+"x)";
		document.getElementById("frames").innerHTML =t+" - Thumbnails every: "+formatTime((myVdo.duration)/(t+1),2);
		clearInterval(interval);
	}
}


  }

function doThumbs()
{
if (loadFlag===true){
captions=[];
thumbs.innerHTML="";
nowFlag=-1;
    
    myVdo.load(); 

 aseek=1;

curr.innerText= formatTime(myVdo.currentTime)+"\n("+myVdo.playbackRate.toLocaleString('en-GB', {minimumFractionDigits: 0, maximumFractionDigits: 7})+"x)";

 myVdo.addEventListener('ratechange', function() {
 	curr.innerText= formatTime(myVdo.currentTime)+"\n("+myVdo.playbackRate.toLocaleString('en-GB', {minimumFractionDigits: 0, maximumFractionDigits: 7})+"x)";
 });

 myVdo.addEventListener('timeupdate', function() {
 
	curr.innerText= formatTime(myVdo.currentTime)+"\n("+myVdo.playbackRate.toLocaleString('en-GB', {minimumFractionDigits: 0, maximumFractionDigits: 7})+"x)";

	for(let i=0;i<captions.length;i++){
	captions[i].innerText=captions[i].previousSibling.attributes.timestamp_fmt.nodeValue;
	captions[i].style.backgroundColor="#00000099";
	}
	
	let cap=myVdo.currentTime*(t+1)/myVdo.duration;
	let cap_el=Math.floor(cap);
	let perc=Math.max(0,(cap-cap_el)*100).toLocaleString('en-GB', {minimumFractionDigits: 1, maximumFractionDigits: 1});

	
if(captions.length==t){

if ((cap_el>0)&&(cap_el-1<captions.length)){
var attr_prev=captions[cap_el-1].previousSibling.attributes;
}else if ((cap_el>0)&&(cap_el-1>=captions.length)){
var attr_prev=captions[captions.length-1].previousSibling.attributes;
}

if(nowFlag>-1){
var attr_now=captions[nowFlag].previousSibling.attributes;
}

if (cap_el<captions.length){
var attr=captions[cap_el].previousSibling.attributes;
	if(nowFlag>-1){
			captions[nowFlag].innerText=attr_now.timestamp_fmt.nodeValue+" (NOW!)";
			captions[nowFlag].style.backgroundColor="#0004ff99";
			nowFlag=-1;
	}else if ((cap==cap_el)&&(cap_el>0)){
			captions[cap_el-1].innerText=attr_prev.timestamp_fmt.nodeValue+" (NOW!)";
			captions[cap_el-1].style.backgroundColor="#0004ff99";
	}else{
		var until=(cap_el<captions.length)?Math.max(0,attr.timestamp.nodeValue-myVdo.currentTime):Math.max(0,myVdo.duration-myVdo.currentTime);
		until=formatTime(until,1);
			captions[cap_el].innerText=attr.timestamp_fmt.nodeValue+" (NEXT) ["+until+"]";
	if (cap_el>0){
			captions[cap_el-1].innerText=attr_prev.timestamp_fmt.nodeValue+" (LAST) ["+perc+"%]";
			captions[cap_el-1].style.backgroundColor="#006115c7";
	}
	}
}else{

	if(nowFlag>-1){
			captions[nowFlag].innerText=attr_now.timestamp_fmt.nodeValue+" (NOW!)";
			captions[nowFlag].style.backgroundColor="#0004ff99";
			nowFlag=-1;
	}else if (cap==cap_el){
		if(cap_el-1>=captions.length){
			captions[captions.length-1].innerText=attr_prev.timestamp_fmt.nodeValue+" (LAST) ["+100+".0%]";
			captions[captions.length-1].style.backgroundColor="#006115c7";
		}else{
		captions[cap_el-1].innerText=attr_prev.timestamp_fmt.nodeValue+" (NOW!)";
		captions[cap_el-1].style.backgroundColor="#0004ff99";
		}
	}else{
			captions[captions.length-1].innerText=attr_prev.timestamp_fmt.nodeValue+" (LAST) ["+perc+"%]";
			captions[captions.length-1].style.backgroundColor="#006115c7";
	}
		
}
}

}, false);

 
myVdo.addEventListener('loadeddata', function() {
if (captions.length==0){
ttmp=1;
	thumbs.innerHTML = "";
   myVdo.currentTime =   (myVdo.duration)/(t+1);
   }
}, false);

myVdo.addEventListener('seeked', function() {

if(aseek==1){  

    generateThumbnail();

    ttmp++;

    if (ttmp<=t) {

        myVdo.currentTime = ttmp*(myVdo.duration/(t+1));

    }else {
aseek=0;
ttmp=1;
myVdo.currentTime=0;
    return;
    }
}else{
return;
}
}, false);



function generateThumbnail() {

var f = document.createElement("figure");;
var ct=document.createElement("figcaption");
console.log(f);
  var c = document.createElement("canvas");
  var ctx = c.getContext("2d");

  let v_width = myVdo.videoWidth;
  let v_height = myVdo.videoHeight;

  c.width= v_width;
   c.height=v_height;   
   
  ct.style.width= v_width;
   ct.style.height=v_height; 

   f.style.width= v_width;
   f.style.height=v_height;

c.setAttribute('timestamp', myVdo.currentTime);
let format_time=formatTime(myVdo.currentTime);
c.setAttribute('timestamp_fmt', format_time);


  ctx.drawImage(myVdo, 0, 0, v_width, v_height);

thumbs.style.zoom=((100/3)*(myVdo.clientWidth/v_width)).toLocaleString('en', {minimumFractionDigits: 0, maximumFractionDigits: 7})+"%";
 thumbs.appendChild(f);

  f.appendChild(c);
    
  ct.innerHTML=format_time;
  f.appendChild(ct);
  captions.push(ct);
  }
  
}else{
alert('Video not loaded!');
}

}



</script>

</body> 

</html>